doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Rent Tracker Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
  :root{
    --bg:#0b1020; --panel:#111936; --panel-2:#0f1730; --panel-3:#10182f; --text:#f1f5f9;
    --muted:#93a4c4; --brand:#4f8cff; --bd:#1c2546; --chip:#1e2a4a;
    --ok:#22c55e; --danger:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; 
    font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg),#060a19 60%); 
    color:var(--text);
  }
  a{color:#7aa7ff}
  th.num, td.num { text-align: right; }

  /* Highlight for overdue invoice count */
  .overdue-alert {
    color: #e74c3c;
    font-weight: 600;
  }

  /* Shell */
    .shell{display:grid;grid-template-rows:auto 1fr auto;min-height:100%}
    header{position:sticky;top:0;z-index:5;background:rgba(15,23,48,.8);backdrop-filter:blur(8px);border-bottom:1px solid var(--bd)}
    .bar{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:12px 20px;max-width:1200px;margin-inline:auto}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:30px;height:30px;border-radius:8px;background:linear-gradient(135deg,#4f8cff,#13b5d1);box-shadow:0 6px 22px rgba(79,140,255,.45)}
    .brand h1{font-size:16px;margin:0;font-weight:700;letter-spacing:.3px}
    .env{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .env input{width:360px;max-width:50vw;background:var(--panel-2);border:1px solid var(--bd);color:var(--text);padding:8px 10px;border-radius:10px}

    .btn{background:#4f8cff;border:none;color:white;padding:9px 12px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn.secondary{background:#223260;color:#dbe7ff}
    .btn.ghost{background:transparent;border:1px solid var(--bd);color:#cfe0ff}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    main{max-width:1200px;margin:18px auto;padding:0 18px;display:grid;grid-template-columns:240px 1fr;gap:18px}
    nav{position:sticky;top:66px;align-self:start;background:var(--panel);border:1px solid var(--bd);border-radius:16px;padding:10px}
    .tab{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;color:var(--text);text-decoration:none;cursor:pointer}
    .tab[aria-selected="true"], .tab:hover{background:var(--chip)}

    .panel{background:var(--panel);border:1px solid var(--bd);border-radius:16px;padding:14px}
    .panel h2{margin:4px 6px 12px;font-size:16px}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .kpi{grid-column:span 3;background:var(--panel-2);border:1px solid var(--bd);border-radius:14px;padding:14px}
    .kpi h3{font-size:12px;color:var(--muted);margin:0}
    .kpi .v{font-size:22px;margin:6px 0 0}

    /* Monthly collection summary layout */
    #collection-summary-month{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      font-size:14px;
    }
    #collection-summary-month > div{
      background:var(--panel-2);
      border:1px solid var(--bd);
      border-radius:10px;
      padding:8px 10px;
      min-width:150px;
    }
    #collection-summary-month strong{ font-size:13px; }

    /* Balances totals strip */
    #balances-summary {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 14px;
    }
    #balances-summary > div {
      background: var(--panel-2);
      border: 1px solid var(--bd);
      border-radius: 10px;
      padding: 6px 10px;
      min-width: 150px;
    }

    .bar-flex{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .chip{background:var(--chip);border:1px solid var(--bd);padding:7px 10px;border-radius:999px;color:#cfe0ff}
    .muted{color:var(--muted)}
    .hidden{display:none!important}

    /* Tables */
    .table-wrap{max-height:60vh;overflow:auto;border-radius:12px}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    thead th{
      position:sticky;top:0;z-index:1;
      background:var(--panel-2);
      font-size:12px;color:#a9b9dc;text-align:left;
      padding:8px 10px;
      border-bottom:1px solid var(--bd)
    }
    tbody td{
      padding:10px 10px;
      background:var(--panel-2);
      border-top:1px solid var(--bd);
      border-bottom:1px solid var(--bd);
      font-size:13px;
    }
    tbody tr td:first-child{
      border-left:1px solid var(--bd);
      border-top-left-radius:10px;border-bottom-left-radius:10px
    }
    tbody tr td:last-child{
      border-right:1px solid var(--bd);
      border-top-right-radius:10px;border-bottom-right-radius:10px
    }

    .status{padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--bd);display:inline-block}
    .status.ok{background:rgba(34,197,94,.08);color:#86efac}
    .status.due{background:rgba(239,68,68,.08);color:#fecaca}
    .status.ended{background:rgba(148,163,184,.08);color:#cbd5e1}

    .filters{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 6px}
    .payments-totals{display:flex;gap:10px;align-items:center;margin-left:auto;}
    .rentroll-totals{display:flex;gap:10px;align-items:center;margin-left:auto;}

    .filters input,.filters select{
      background:var(--panel-2);border:1px solid var(--bd);color:var(--text);
      padding:8px 10px;border-radius:10px
    }
    .empty{color:var(--muted);text-align:center;padding:18px;background:var(--panel-2);border:1px dashed var(--bd);border-radius:12px}

    .month-wrapper{display:flex;align-items:center;gap:6px;}
    .month-wrapper span{font-size:13px;color:var(--muted);}
    #monthPicker{
      background:var(--panel-2);
      border:1px solid var(--bd);
      color:var(--text);
      padding:6px 10px;
      border-radius:10px;
      min-width:150px;
    }
    #monthPicker::-webkit-calendar-picker-indicator{filter:invert(1);}

    /* Section divider */
    .section-split{
      display:flex;
      align-items:center;
      gap:12px;
      opacity:.95;
    }
    .section-split .split-line{ height:1px; flex:1; background: var(--bd); }
    .section-split .split-label{
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: var(--muted);
      padding:6px 10px;
      border:1px solid var(--bd);
      border-radius:999px;
      background: rgba(255,255,255,.03);
    }

    /* Dunning action strip */
    .dunning-actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:8px;
    }
    .dunning-links{
      margin-top:10px;
      padding:10px;
      border:1px solid var(--bd);
      border-radius:12px;
      background: rgba(255,255,255,.03);
    }
    .dunning-links a{display:block;margin:6px 0;}

    @media (max-width:980px){
      main{grid-template-columns:1fr}
      nav{position:static}
      .kpi{grid-column:span 6}
    }
    @media (max-width:640px){
      .kpi{grid-column:span 12}
      .env input{max-width:100%;width:220px}
      .table-wrap{max-height:50vh}
    }
  </style>
</head>

<body>
<div class="shell">
  <header>
    <div class="bar">
      <div class="brand">
        <div class="logo"></div>
        <h1>Rent Tracker Dashboard</h1>
      </div>
      <div class="env">
        <input id="apiBase" placeholder="API base e.g. https://rent-tracker-api-16i0.onrender.com"/>
        <button class="btn" id="useApi">Use this API</button>
        <button class="btn secondary" id="openDocs">/docs</button>
        <button class="btn ghost" id="setAdminTokenBtn" title="Set Admin Token">‚öôÔ∏è Admin Token</button>
      </div>
    </div>
  </header>

  <main>
    <!-- LEFT NAV -->
    <nav aria-label="Sections">
      <a class="tab" data-tab="overview" aria-selected="true">üè† Overview</a>
      <a class="tab" data-tab="leases">üîë Leases</a>
      <a class="tab" data-tab="payments">üí∏ Payments</a>
      <a class="tab" data-tab="rentroll">üßæ Rent Roll</a>
      <a class="tab" data-tab="balances">üìä Balances</a>
      <a class="tab" data-tab="dunning">üîî Dunning</a>
      <a class="tab" data-tab="whatsapp">üì± WhatsApp</a>
      <a class="tab" data-tab="settings">‚öôÔ∏è Settings</a>
    </nav>

    <!-- RIGHT CONTENT -->
    <section>

      <!-- ===== Overview ===== -->
      <div class="panel" id="tab-overview">
        <h2>Overview</h2>

        <div class="grid" id="kpis">
          <div class="kpi"><h3>Active leases</h3><div class="v" id="kpiLeases">‚Äî</div></div>
          <div class="kpi"><h3>Unpaid invoices (month)</h3><div class="v" id="kpiOpen">‚Äî</div></div>
          <div class="kpi"><h3>Rent received (month)</h3><div class="v" id="kpiPayments">‚Äî</div></div>
          <div class="kpi"><h3>Rent overdue (month)</h3><div class="v" id="kpiBalance">‚Äî</div></div>
        </div>

        <div class="filters">
          <div class="month-wrapper">
            <span>Month</span>
            <input id="monthPicker" type="month" />
          </div>
        </div>

        <p class="muted" style="margin-top:6px;margin-bottom:2px;">Monthly collection summary</p>
        <div id="collection-summary-month">
          <div><strong id="summaryMonthLabel">‚Äî</strong></div>
          <div id="summaryMonthDue">Rent billed (month)</div>
          <div id="summaryMonthCollected">Rent received (month)</div>
          <div id="summaryCashReceived">Cash received (month) KES 0</div>
          <div id="summaryMonthBalance">Arrears (start/end)</div>
          <div id="summaryMonthRate">Rent collection rate</div>
          <div id="summaryArrearsCleared">Arrears paid (month) KES 0</div>
          <div id="summaryOverpayments">Tenant credit (prepaid) KES 0</div>
        </div>
      </div>

      <!-- ===== Leases ===== -->
      <div class="panel hidden" id="tab-leases">
        <div class="bar-flex">
          <h2>Leases</h2><span class="chip" id="leasesCount">‚Äî</span>
        </div>

        <div class="filters">
          <input id="leasesTenant" placeholder="Search tenant or unit‚Ä¶"/>
          <button class="btn" id="applyLeases">Apply</button>
          <button class="btn ghost" id="clearLeases">Clear</button>
          <button class="btn ghost" id="reloadLeases">Reload</button>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Tenant</th>
                <th>Unit</th>
                <th class="num">Rent</th>
                <th>Cycle</th>
                <th>Due day</th>
                <th>Status</th>
                <th>WhatsApp</th>
              </tr>
            </thead>
            <tbody id="leasesBody"></tbody>
          </table>
        </div>
        <div id="leasesEmpty" class="empty hidden">No leases to show yet.</div>
      </div>

      <!-- ===== Payments ===== -->
      <div class="panel hidden" id="tab-payments">
        <div class="bar-flex">
          <h2>Payments</h2><span class="chip" id="paymentsCount">‚Äî</span>
        </div>
        <div class="filters">
          <select id="paymentsMonth"></select>
          <input id="paymentsTenant" placeholder="Tenant / payer contains‚Ä¶"/>
          <select id="paymentsStatus">
            <option value="">Any status</option>
            <option value="allocated">allocated</option>
            <option value="unallocated">unallocated</option>
            <option value="posted">posted</option>
            <option value="pending">pending</option>
            <option value="failed">failed</option>
          </select>
          <button class="btn" id="applyPayments">Apply</button>
          <button class="btn ghost" id="clearPayments">Clear</button>

          <div class="payments-totals">
            <span class="chip" id="paymentsCountChip">0</span>
            <span class="chip" id="paymentsTotalChip">KES 0</span>
          </div>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr><th>Date</th><th>Tenant / payer</th><th>Method</th><th class="muted">Status</th><th class="num">Amount</th></tr>
            </thead>
            <tbody id="paymentsBody"></tbody>
          </table>
        </div>
        <div id="paymentsEmpty" class="empty hidden">No payments match your filters.</div>
      </div>

      <!-- ===== Rent Roll ===== -->
      <div class="panel hidden" id="tab-rentroll">
        <div class="bar-flex">
          <h2>Rent Roll</h2><span class="chip" id="rentrollCount">‚Äî</span>
        </div>
        <div class="filters">
          <select id="rentrollMonth"></select>
          <input id="rentrollTenant" placeholder="Tenant contains‚Ä¶"/>
          <input id="rentrollProperty" placeholder="Property contains‚Ä¶"/>
          <button class="btn" id="applyRentroll">Apply</button>
          <button class="btn ghost" id="clearRentroll">Clear</button>

          <div class="rentroll-totals">
            <span class="chip" id="rentrollDueChip">KES 0 billed</span>
            <span class="chip" id="rentrollPaidChip">KES 0 received</span>
            <span class="chip" id="rentrollBalChip">KES 0 overdue</span>
            <span class="chip" id="rentrollCreditChip">KES 0 prepaid credit</span>
          </div>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Property</th>
                <th>Unit</th>
                <th>Tenant</th>
                <th>Period</th>
                <th class="num">Rent</th>
                <th class="num">Late fees</th>
                <th>Status</th>
                <th class="num">Balance (end)</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="rentrollBody"></tbody>
          </table>
        </div>
        <div id="rentrollEmpty" class="empty hidden">No rent-roll rows match your filters.</div>
      </div>

      <!-- ===== Balances ===== -->
      <div class="panel hidden" id="tab-balances">
        <div class="bar-flex">
          <h2>Balances</h2>
          <button id="reloadBalances" class="btn ghost">Reload</button>
          <button id="btnExportBalances" class="btn ghost">Export CSV</button>
        </div>

        <div class="filters">
          <select id="balancesMonth"></select>
        </div>

        <div class="table-wrap" style="margin-top:12px;">
          <table>
            <thead>
              <tr>
                <th>Tenant</th>
                <th class="num">Rent billed (month)</th>
                <th class="num">Rent received (month)</th>
                <th class="num">Arrears (end)</th>
                <th class="num">Rent collection rate</th>
              </tr>
            </thead>
            <tbody id="balancesBody"></tbody>
          </table>
        </div>
        <div id="balancesEmpty" class="empty hidden">No balances to show yet.</div>

        <div style="margin-top:24px;">
          <h3 style="margin:0 0 8px 0;">This month totals (all tenants)</h3>
          <div id="balances-summary">
            <div class="chip"><strong id="balMonthLabel">‚Äî</strong></div>
            <div class="chip" id="balMonthDue">KES 0 billed</div>
            <div class="chip" id="balMonthCollected">KES 0 received</div>
            <div class="chip" id="balMonthBalance">KES 0 arrears (end)</div>
            <div class="chip" id="balMonthRate">0.0% rent collection rate</div>
          </div>
          <p id="balancesLastUpdated" class="muted" style="margin:6px 0 0 0;">Last updated: ‚Äî</p>
        </div>

        <!-- Divider -->
        <div class="section-split" style="margin-top:24px;">
          <div class="split-line"></div>
          <div class="split-label">Outstanding</div>
          <div class="split-line"></div>
        </div>

        <div class="bar-flex" style="margin-top:12px;">
          <h3 style="margin:0;">Rent overdue by tenant (month)</h3>
          <span class="chip" id="outstandingMonthLabel">‚Äî</span>
          <button id="reloadOutstandingByTenant" class="btn ghost">Reload</button>
          <span class="muted">Actions moved to <b>Dunning</b>.</span>
        </div>

        <p id="outstandingLastUpdated" class="muted" style="margin:4px 0 0 0;">Last updated: ‚Äî</p>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Tenant</th>
                <th class="num">Overdue</th>
                <th class="num">Rent collection rate</th>
              </tr>
            </thead>
            <tbody id="outstandingBody"></tbody>
          </table>
        </div>
        <div id="outstandingEmpty" class="empty hidden">No outstanding balances this month üéâ</div>
      </div>

      <!-- ===== Dunning (Action Center) ===== -->
      <div class="panel hidden" id="tab-dunning">
        <div class="bar-flex">
          <h2>Dunning</h2>
          <span class="chip" id="dunningMonthLabel">‚Äî</span>
          <span id="dunningInvoiceCount" class="muted small"></span>
          <button id="reloadDunning" class="btn ghost">Reload</button>
        </div>

        <p id="dunningLastUpdated" class="muted" style="margin:4px 0 0 0;">Last updated: ‚Äî</p>

        <div class="filters" style="margin-top:10px;">
          <select id="dunningMonth"></select>
          <input id="dunningMinDaysOverdue" type="number" min="0" value="0" placeholder="Min days overdue (e.g., 6)"/>
          <span class="muted">Tip: set Min days to your grace days + 1 to target only past-grace.</span>
        </div>

        <div class="dunning-actions">
          <label class="muted" style="display:flex;gap:8px;align-items:center;">
            <input type="checkbox" id="dunningSelectAll"/>
            Select all
          </label>

          <button class="btn" id="btnDunningBuildLinks">Build WhatsApp links (Selected)</button>
          <button class="btn secondary" id="btnDunningMarkSent">Mark Selected as Sent</button>

          <span class="muted" id="dunningMsg"></span>
        </div>

        <div class="table-wrap" style="margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th></th>
                <th>Tenant</th>
                <th class="num">Overdue (month)</th>
                <th class="num">Total owed</th>
                <th class="num">Days overdue</th>
                <th class="num">Rent collection rate</th>
                <th>WhatsApp</th>
                <th>Invoice</th>
              </tr>
            </thead>
            <tbody id="dunningBody"></tbody>
          </table>
        </div>
        <div id="dunningEmpty" class="empty hidden">No dunning items match your filter üéâ</div>

        <div id="dunningLinks" class="dunning-links hidden">
          <div class="muted" style="margin-bottom:6px;">
            Click links below (this avoids pop-up blockers when sending many messages):
          </div>
          <div id="dunningLinksBody"></div>
        </div>
      </div>

      <!-- ===== WhatsApp (ad-hoc builder) ===== -->
      <div class="panel hidden" id="tab-whatsapp">
        <h2>WhatsApp Message (ad-hoc)</h2>
        <div class="filters">
          <input id="waTenant" placeholder="Tenant name"/>
          <input id="waPhone" placeholder="Phone (2547‚Ä¶ or 07‚Ä¶ or +2547‚Ä¶)"/>
          <input id="waPeriod" placeholder="Period label (e.g., Dec 2025)"/>
          <input id="waBalance" type="number" placeholder="Balance amount (KSh)"/>
          <button class="btn" id="waBuild">Build Link</button>
        </div>
        <p class="muted">
          For collections, use <b>Dunning</b> (it uses month + outstanding data).
        </p>
        <div id="waResult" class="muted"></div>
      </div>


      <!-- ===== Balances ===== -->
      <div class="panel hidden" id="tab-balances">
        <div class="bar-flex">
          <h2>Balances</h2>
          <button id="reloadBalances" class="btn ghost">Reload</button>
          <button id="btnExportBalances" class="btn ghost">Export CSV</button>
        </div>

        <div class="filters">
          <select id="balancesMonth"></select>
        </div>

        <div class="table-wrap" style="margin-top:12px;">
          <table>
            <thead>
              <tr>
                <th>Tenant</th>
                <th class="num">Rent billed (month)</th>
                <th class="num">Rent received (month)</th>
                <th class="num">Arrears (end)</th>
                <th class="num">Rent collection rate</th>
              </tr>
            </thead>
            <tbody id="balancesBody"></tbody>
          </table>
        </div>
        <div id="balancesEmpty" class="empty hidden">No balances to show yet.</div>

        <div style="margin-top:24px;">
          <h3 style="margin:0 0 8px 0;">This month totals (all tenants)</h3>
          <div id="balances-summary">
            <div class="chip"><strong id="balMonthLabel">‚Äî</strong></div>
            <div class="chip" id="balMonthDue">KES 0 billed</div>
            <div class="chip" id="balMonthCollected">KES 0 received</div>
            <div class="chip" id="balMonthBalance">KES 0 arrears (end)</div>
            <div class="chip" id="balMonthRate">0.0% rent collection rate</div>
          </div>
          <p id="balancesLastUpdated" class="muted" style="margin:6px 0 0 0;">Last updated: ‚Äî</p>
        </div>

        <!-- Divider -->
        <div class="section-split" style="margin-top:24px;">
          <div class="split-line"></div>
          <div class="split-label">Outstanding</div>
          <div class="split-line"></div>
        </div>

        <div class="bar-flex" style="margin-top:12px;">
          <h3 style="margin:0;">Rent overdue by tenant (month)</h3>
          <span class="chip" id="outstandingMonthLabel">‚Äî</span>
          <button id="reloadOutstandingByTenant" class="btn ghost">Reload</button>
          <span class="muted">Actions moved to <b>Dunning</b>.</span>
        </div>

        <p id="outstandingLastUpdated" class="muted" style="margin:4px 0 0 0;">Last updated: ‚Äî</p>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Tenant</th>
                <th class="num">Overdue</th>
                <th class="num">Rent collection rate</th>
              </tr>
            </thead>
            <tbody id="outstandingBody"></tbody>
          </table>
        </div>
        <div id="outstandingEmpty" class="empty hidden">No outstanding balances this month üéâ</div>
      </div>

      <!-- ===== Dunning (Action Center) ===== -->
      <div class="panel hidden" id="tab-dunning">
        <div class="bar-flex">
          <h2>Dunning</h2>
          <span class="chip" id="dunningMonthLabel">‚Äî</span>
          <button id="reloadDunning" class="btn ghost">Reload</button>
        </div>

        <p id="dunningLastUpdated" class="muted" style="margin:4px 0 0 0;">Last updated: ‚Äî</p>

        <div class="filters" style="margin-top:10px;">
          <select id="dunningMonth"></select>
          <input id="dunningMinDaysOverdue" type="number" min="0" value="0" placeholder="Min days overdue (e.g., 6)"/>
          <span class="muted">Tip: set Min days to your grace days + 1 to target only past-grace.</span>
        </div>

        <div class="dunning-actions">
          <label class="muted" style="display:flex;gap:8px;align-items:center;">
            <input type="checkbox" id="dunningSelectAll"/>
            Select all
          </label>

          <button class="btn" id="btnDunningBuildLinks">Build WhatsApp links (Selected)</button>
          <button class="btn secondary" id="btnDunningMarkSent">Mark Selected as Sent</button>

          <span class="muted" id="dunningMsg"></span>
        </div>

        <div class="table-wrap" style="margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th></th>
                <th>Tenant</th>
                <th class="num">Overdue (month)</th>
                <th class="num">Total owed</th>
                <th class="num">Days overdue</th>
                <th class="num">Rent collection rate</th>
                <th>WhatsApp</th>
                <th>Invoice</th>
              </tr>
            </thead>
            <tbody id="dunningBody"></tbody>
          </table>
        </div>        
      </div>

      <!-- ===== WhatsApp (ad-hoc builder) ===== -->
      <div class="panel hidden" id="tab-whatsapp">
        <h2>WhatsApp Message (ad-hoc)</h2>
        <div class="filters">
          <input id="waTenant" placeholder="Tenant name"/>
          <input id="waPhone" placeholder="Phone (2547‚Ä¶ or 07‚Ä¶ or +2547‚Ä¶)"/>
          <input id="waPeriod" placeholder="Period label (e.g., Dec 2025)"/>
          <input id="waBalance" type="number" placeholder="Balance amount (KSh)"/>
          <button class="btn" id="waBuild">Build Link</button>
        </div>
        <p class="muted">
          For collections, use <b>Dunning</b> (it uses month + outstanding data).
        </p>
        <div id="waResult" class="muted"></div>
      </div>

      <!-- ===== Settings ===== -->
      <div class="panel hidden" id="tab-settings">
        <h2>Settings</h2>
        <p class="muted">Saved only in this browser (localStorage).</p>

        <div class="filters" style="gap:14px;align-items:center;flex-wrap:wrap">
          <label style="display:flex;gap:8px;align-items:center">API Base
            <input id="apiBase2" placeholder="https://rent-tracker-api-16i0.onrender.com"/>
          </label>
          <label style="display:flex;gap:8px;align-items:center">Admin Token
            <input id="adminToken" type="password" placeholder="paste your ADMIN_TOKEN" autocomplete="off"/>
          </label>
          <button class="btn" id="saveSettings">Save</button>
          <button class="btn ghost" id="resetSettings">Reset</button>
        </div>

        <!-- Invoice Actions moved here -->
        <div class="panel" style="margin-top:14px;">
          <h3 style="margin:0 0 8px;">Admin Tools ‚Äî Invoice Actions</h3>
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <input id="invoiceIdInput" type="text" placeholder="invoice_id (UUID)"
                   style="flex:1;min-width:260px;padding:8px;border-radius:10px;border:1px solid var(--bd);background:var(--panel-2);color:var(--text);">
            <button id="btnMarkSent" class="btn">Mark as sent</button>
            <button id="btnHealth" class="btn ghost">Auth ping</button>
          </div>
          <div id="actionMsg" style="margin-top:8px;font-size:14px;color:var(--muted);"></div>
        </div>
      </div>

    </section>
  </main>
</div>

<script>
(function(){
  window.getAdminToken = window.getAdminToken || function(){
    let t = localStorage.getItem("admin_token");
    if(!t){
      t = prompt("Enter X-Admin-Token (ADMIN_TOKEN) to enable admin actions:");
      if(t) localStorage.setItem("admin_token", t);
    }
    return t || "";
  };
  window.setAdminToken = window.setAdminToken || function(t){
    localStorage.setItem("admin_token", t);
  };

  const btn = document.getElementById("setAdminTokenBtn");
  if(btn && !btn.dataset.bound){
    btn.dataset.bound = "1";
    btn.addEventListener("click", ()=>{
      const t = prompt("Paste ADMIN_TOKEN");
      if(t) window.setAdminToken(t);
    });
  }
})();
</script>
<script src="app.js?v=20260111-2"></script>
</body>
</html>
